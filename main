Dim newname, shn, newname2 As String
Sub 工作簿生成()



      newname2 = InputBox("请输入汇总表工作簿的名称：")
      On Error GoTo endd
Dim iFile As String
iFile = ThisWorkbook.Path & "\" & newname2 & ".xls"
Workbooks.add
ActiveWorkbook.SaveAs iFile, True

        
        newname = InputBox("请输入数据表工作簿的名称：")
        On Error GoTo endd
 
        
       
        
     Workbooks(newname & ".xls").Activate

     For Each sh In Worksheets    '数组
     
        sh.Select
   
    If sh.Cells(4, 9).Value = "压力变送器" Then
    
  
   Call 压变列表
   
    ElseIf sh.Cells(4, 9).Value = "电磁流量计" Then
    

    
 Call 电磁列表
    
    ElseIf sh.Cells(4, 9).Value = "差压变送器(液位)" Then
    
 Call 差压液位列表
    
    ElseIf sh.Cells(4, 4).Value = "调节阀" Then
    
    
 Call 调节阀列表
     ElseIf sh.Cells(4, 9).Value = "气动切断阀" Then
    
    
 Call 开关阀列表
    
    shn = ActiveSheet.Name

    End If
Next

'MsgBox "新建工作薄," & vbCrLf & "完整路径及名称:" & vbCrLf & iFile
endd:
End Sub

Sub 电磁列表()

      Dim NewName6 As String
      
      NewName6 = "电磁"
      
      Workbooks(newname2 & ".xls").Sheets.add.Name = NewName6



Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2 As Integer


Dim arr() As Variant


n9 = 9
yl = 10 '数据源列
fl = 1  '新表列
j9 = n9  '数据源行
i = 1   '数据源非空行
ll = 0  '单个数据表页中包含几列仪表
a2 = 2  '新表行
dh = 0 '被删除行数

nei:




If n9 > 9 And n9 < 14 Then

ElseIf n9 > 14 And n9 < 21 Then
GoTo jixu

ElseIf n9 > 24 And n9 < 33 Then
GoTo jixu

ElseIf n9 > 34 And n9 < 38 Then
GoTo jixu


ElseIf n9 = 41 Then
GoTo jixu

ElseIf n9 = 42 Then
GoTo jixu


ElseIf n9 = 43 Then
GoTo ee

Else: GoTo jia
End If

jixu:

Do

  
    
Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
    
    ll = ll + 1
    yl = yl + 6
  
    a2 = a2 + 1
   If ll Mod 3 = 0 Then
   j9 = j9 + 50
  i = i + 50
   yl = 10

   End If
   
    

 
Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
j9 = n9
kh = a2
 i = 1
 fl2 = fl
 fl = fl + 1


yl = 10
ll = 0
a2 = 2
jia:
n9 = n9 + 1

GoTo nei




ee:

 Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
 '空行
 For kh2 = kh To 2 Step -1
 If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Rows(kh2)) = 0 Then
 dh = dh + 1
 Rows(kh2).Delete
 End If
 Next kh2
 
 lh = kh - dh   '新表最终行数
 lh2 = lh + 1
 arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "最大流量", "正常流量", "最小流量", "量程", "公称通径", "本体材质", "衬里材质", "电极材质", "法兰标准", "法兰尺寸", "接地环材质", "输出信号", "精度", "电源", "安装形式")

 Range(Cells(1, 1), Cells(1, fl2)) = arr
 
 Range(Cells(1, 1), Cells(lh, fl2)).Select
     Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    
' 行高 宏
'

'
    Selection.RowHeight = 22
    
    
    '字体设置
     With Selection.Font
        .Name = "宋体"
        .Size = 9
        .Strikethrough = False
        .Superscript = False
        .Subscript = False
        .OutlineFont = False
        .Shadow = False
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .ThemeFont = xlThemeFontNone
    End With
 ' 居中
'

'
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
 '自动列宽
        Selection.Columns.AutoFit
        

       Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        
       Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        
        ' 加粗冻结 宏
        
 Range(Cells(1, 1), Cells(1, fl2)).Select

'
    Selection.Font.Bold = True
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorAccent3
        .TintAndShade = 0.599993896298105
        .PatternTintAndShade = 0
    End With
    With ActiveWindow
        .SplitColumn = 0
        .SplitRow = 1
    End With
    ActiveWindow.FreezePanes = True
        
                Workbooks(newname & ".xls").Activate '返回数据表文件
endd:
End Sub

Sub 差压液位列表()

      Dim NewName6 As String
      
      NewName6 = "差压液位"
      
       Workbooks(newname2 & ".xls").Sheets.add.Name = NewName6



      
      On Error GoTo endd


Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2 As Integer



Dim arr() As Variant


n9 = 9
yl = 10 '数据源列
fl = 1  '新表列
j9 = n9  '数据源行
i = 1   '数据源非空行
ll = 0  '单个数据表页中包含几列仪表
a2 = 2  '新表行


dh = 0 '被删除行数

nei:




If n9 > 9 And n9 < 14 Then
GoTo jixu

ElseIf n9 > 14 And n9 < 18 Then
GoTo jixu

ElseIf n9 > 23 And n9 < 28 Then
GoTo jixu

ElseIf n9 > 35 And n9 < 40 Then
GoTo jixu

ElseIf n9 = 45 Then
GoTo ee

Else: GoTo jia
End If

jixu:

Do


    
Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
    
    ll = ll + 1
    yl = yl + 6
  
    a2 = a2 + 1
   If ll Mod 3 = 0 Then
   j9 = j9 + 50
  i = i + 50
   yl = 10

   End If
   
        
  
Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
j9 = n9
kh = a2
 i = 1
 fl2 = fl
 fl = fl + 1


yl = 10
ll = 0
a2 = 2
jia:
n9 = n9 + 1

GoTo nei




ee:


Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
 '空行
 For kh2 = kh To 2 Step -1
 If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Rows(kh2)) = 0 Then
 dh = dh + 1
 Rows(kh2).Delete
 End If
 Next kh2
 
 lh = kh - dh   '新表最终行数
 lh2 = lh + 1
 arr = Array("位号", "数量", "用途", "PID号", "设备位号", "介质", "压力", "温度", "量程", "精度", "输出信号", "测量元件材质", "密封膜片材质", "法兰标准及等级", "法兰尺寸及密封面")

 Range(Cells(1, 1), Cells(1, fl2)) = arr
 
 Range(Cells(1, 1), Cells(lh, fl2)).Select
     Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    
    ' 行高 宏
'

'
    Selection.RowHeight = 22
    
    '字体设置
     With Selection.Font
        .Name = "宋体"
        .Size = 9
        .Strikethrough = False
        .Superscript = False
        .Subscript = False
        .OutlineFont = False
        .Shadow = False
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .ThemeFont = xlThemeFontNone
    End With
 ' 居中
'

'
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
 '自动列宽
        Selection.Columns.AutoFit
        

        
                        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        
       Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        
 Range(Cells(1, 1), Cells(1, fl2)).Select

'
    Selection.Font.Bold = True
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorAccent3
        .TintAndShade = 0.599993896298105
        .PatternTintAndShade = 0
    End With
    With ActiveWindow
        .SplitColumn = 0
        .SplitRow = 1
    End With
    ActiveWindow.FreezePanes = True
        
                Workbooks(newname & ".xls").Activate '返回数据表文件
endd:
End Sub
Sub 压变列表()

      Dim NewName6 As String
      
      NewName6 = "压变"
      
       Workbooks(newname2 & ".xls").Sheets.add.Name = NewName6




Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2 As Integer



Dim arr() As Variant


n9 = 9
yl = 10 '数据源列
fl = 1  '新表列
j9 = n9  '数据源行
i = 1   '数据源非空行
ll = 0  '单个数据表页中包含几列仪表
a2 = 2  '新表行

dh = 0 '被删除行数

nei:


If n9 > 9 And n9 < 12 Then
GoTo jixu

ElseIf n9 > 12 And n9 < 15 Then
GoTo jixu

ElseIf n9 > 15 And n9 < 19 Then
GoTo jixu

ElseIf n9 = 22 Then
GoTo jixu

ElseIf n9 = 24 Then
GoTo jixu

ElseIf n9 = 26 Then
GoTo jixu

ElseIf n9 > 38 And n9 < 43 Then
GoTo jixu


ElseIf n9 = 45 Then
GoTo ee

Else: GoTo jia
End If

jixu:

Do


    
Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
    
    ll = ll + 1
    yl = yl + 6
  
    a2 = a2 + 1
   If ll Mod 3 = 0 Then
   j9 = j9 + 50
  i = i + 50
   yl = 10

   End If
   
    
Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
j9 = n9
kh = a2
 i = 1
 fl2 = fl
 fl = fl + 1


yl = 10
ll = 0
a2 = 2
jia:
n9 = n9 + 1


GoTo nei




ee:
Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
 '空行
 For kh2 = kh To 2 Step -1
 If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Rows(kh2)) = 0 Then
 dh = dh + 1
 Rows(kh2).Delete
 End If
 Next kh2
 
 lh = kh - dh   '新表最终行数
 lh2 = lh + 1
 arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "量程", "输出信号", "测量元件材质", "密封膜片材质", "法兰标准及等级", "法兰尺寸及密封面", "法兰材质")

 Range(Cells(1, 1), Cells(1, fl2)) = arr
 
 Range(Cells(1, 1), Cells(lh, fl2)).Select
     Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    
    ' 行高 宏
'

'
    Selection.RowHeight = 22
    
    '字体设置
     With Selection.Font
        .Name = "宋体"
        .Size = 9
        .Strikethrough = False
        .Superscript = False
        .Subscript = False
        .OutlineFont = False
        .Shadow = False
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .ThemeFont = xlThemeFontNone
    End With
 ' 居中
'

'
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
 '自动列宽
        Selection.Columns.AutoFit
        
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        
       Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        
        
        ' 加粗冻结 宏
        
 Range(Cells(1, 1), Cells(1, fl2)).Select

'
    Selection.Font.Bold = True
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorAccent3
        .TintAndShade = 0.599993896298105
        .PatternTintAndShade = 0
    End With
    With ActiveWindow
        .SplitColumn = 0
        .SplitRow = 1
    End With
    ActiveWindow.FreezePanes = True
        
        Workbooks(newname & ".xls").Activate
endd:
End Sub
Sub 调节阀列表()



      Dim NewName6 As String
      
      NewName6 = "调节阀"
      
       Workbooks(newname2 & ".xls").Sheets.add.Name = NewName6



      On Error GoTo endd


Dim j9, n9, yl, i, a2, fl, kh, kh2, fl2, dh, lh As Integer



Dim arr() As Variant


n9 = 9
yl = 5 '数据源列
fl = 1  '新表列
j9 = n9  '数据源行
i = 1   '数据源非空行

a2 = 2  '新表行
fl = 1  '新表列
emp = 0
dh = 0 '被删除行数

nei:


If n9 > 9 And n9 < 16 Then
GoTo jixu

ElseIf n9 > 16 And n9 < 20 Then
GoTo jixu

ElseIf n9 = 36 Then
GoTo jixu


ElseIf n9 = 38 Then
GoTo jixu


ElseIf n9 > 42 And n9 < 46 Then
GoTo jixu

ElseIf n9 = 46 Then
GoTo ee

Else: GoTo jia
End If

jixu:

Do

Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
    

  
    a2 = a2 + 1

  j9 = j9 + 50
 i = i + 50

  
 
Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0

j9 = n9
kh = a2
 i = 1
 fl2 = fl
 fl = fl + 1


yl = 5
ll = 0
a2 = 2
jia:
n9 = n9 + 1
GoTo nei




ee:
Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
 '空行
 For kh2 = kh To 2 Step -1
 If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Rows(kh2)) = 0 Then
 dh = dh + 1
 Rows(kh2).Delete
 End If
 Next kh2
 
 lh = kh - dh   '新表最终行数
 lh2 = lh + 1
 arr = Array("位号", "数量", "用途", "PID号", "管道编号", "管道材质", "管道规格", "介质", "温度", "压力", "阀门形式", "阀座尺寸", "阀体材质", "阀芯材质")

 Range(Cells(1, 1), Cells(1, fl2)) = arr
 
 Range(Cells(1, 1), Cells(lh, fl2)).Select
     Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    
    ' 行高 宏
'

'
    Selection.RowHeight = 22
    
    '字体设置
     With Selection.Font
        .Name = "宋体"
        .Size = 9
        .Strikethrough = False
        .Superscript = False
        .Subscript = False
        .OutlineFont = False
        .Shadow = False
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .ThemeFont = xlThemeFontNone
    End With
 ' 居中
'

'
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With

 '自动列宽
        Selection.Columns.AutoFit
        
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        
       Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        
        
        ' 加粗冻结 宏
        
 Range(Cells(1, 1), Cells(1, fl2)).Select

'
    Selection.Font.Bold = True
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorAccent3
        .TintAndShade = 0.599993896298105
        .PatternTintAndShade = 0
    End With
    With ActiveWindow
        .SplitColumn = 0
        .SplitRow = 1
    End With
    ActiveWindow.FreezePanes = True
        
        Workbooks(newname & ".xls").Activate
endd:
End Sub

Sub 开关阀列表()
      Dim NewName6 As String
      
      NewName6 = "开关阀"
      
       Workbooks(newname2 & ".xls").Sheets.add.Name = NewName6



Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2  As Integer



Dim arr() As Variant


n9 = 9
yl = 10 '数据源列
fl = 1  '新表列
j9 = n9  '数据源行
i = 1   '数据源非空行
ll = 0  '单个数据表页中包含几列仪表
a2 = 2  '新表行
fl = 1  '新表列
dh = 0 '被删除行数

nei:


If n9 > 9 And n9 < 16 Then
GoTo jixu

ElseIf n9 > 16 And n9 < 20 Then
GoTo jixu

ElseIf n9 > 23 And n9 < 28 Then
GoTo jixu


ElseIf n9 > 31 And n9 < 35 Then
GoTo jixu


ElseIf n9 = 45 Then
GoTo ee

Else: GoTo jia
End If

jixu:

Do


    
Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
    
    
    ll = ll + 1
    yl = yl + 6
  
    a2 = a2 + 1
   If ll Mod 3 = 0 Then
   j9 = j9 + 50
  i = i + 50
   yl = 10

   End If
   
    

 
Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0

j9 = n9
kh = a2
 i = 1
 fl2 = fl
 fl = fl + 1


yl = 10
ll = 0
a2 = 2
jia:
n9 = n9 + 1

GoTo nei




ee:
Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
 '空行
 For kh2 = kh To 2 Step -1
 If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Rows(kh2)) = 0 Then
 dh = dh + 1
 Rows(kh2).Delete
 End If
 Next kh2
 
 lh = kh - dh   '新表最终行数
 lh2 = lh + 1
 arr = Array("位号", "数量", "用途", "PID号", "管道编号", "管道材质", "管道规格", "介质", "压力", "温度", "阀门形式", "公称通径", "阀体材质", "阀芯材质", "法兰标准及等级", "法兰尺寸及密封面")

 Range(Cells(1, 1), Cells(1, fl2)) = arr
 
 Range(Cells(1, 1), Cells(lh, fl2)).Select
     Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    
    ' 行高 宏
'

'
    Selection.RowHeight = 22
    
    '字体设置
     With Selection.Font
        .Name = "宋体"
        .Size = 9
        .Strikethrough = False
        .Superscript = False
        .Subscript = False
        .OutlineFont = False
        .Shadow = False
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .ThemeFont = xlThemeFontNone
    End With
 ' 居中
'

'
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
  '自动列宽
        Selection.Columns.AutoFit
        
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        
       Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        
        
        ' 加粗冻结 宏
        
 Range(Cells(1, 1), Cells(1, fl2)).Select

'
    Selection.Font.Bold = True
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorAccent3
        .TintAndShade = 0.599993896298105
        .PatternTintAndShade = 0
    End With
    With ActiveWindow
        .SplitColumn = 0
        .SplitRow = 1
    End With
    ActiveWindow.FreezePanes = True
        
        Workbooks(newname & ".xls").Activate
endd:
End Sub
